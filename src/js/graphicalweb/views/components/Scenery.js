/*global define, $, TWEEN, Savage, d3 */
define(['text!graphicalweb/views/html/scenery.html',
        'text!graphicalweb/views/svg/terrain.svg',
        'graphicalweb/controllers/CameraController',
        'graphicalweb/models/AssetModel',
        'graphicalweb/utils/CSS3Helper'
        ],

	function (scenery_html, 
        scenery_svg,
        Camera, 
        AssetModel,
        CSS3Helper) {
		
		var Scenery = function () {
			var instance = this,
                USE_CANVAS = false,
                curvy = false,
                rotated = false,
                frame = 0,
                goalFrame = 0,
                bgposition = 0,
                delta = {x: -200},
                elementcount = 5,
                parallaxGroupA,
                parallaxGroupB,
                terrainInterval,
                $body,
                $container,
                $clouds,
                canvas,
                ctx,
                parallaxGroup = [],
                clipGroup = [],
                clips = [],
                paths = [],
                trees = [],
                parallaxA = [],
                imgList = [],
                treegroup1 = [
                    {x: 0, y: 600},
                    {x: 0, y: 570},
                    {x: 0, y: 630},
                    {x: 0, y: 550},
                    {x: 0, y: 630},
                    {x: 0, y: 570},
                    {x: 0, y: 600},
                    {x: 0, y: 610},
                    {x: 0, y: 600},
                    {x: 0, y: 600}
                ],
                bushgroup1 = [
                    {x: 0, y: 610},
                    {x: 0, y: 615},
                    {x: 0, y: 620},
                    {x: 0, y: 550},
                    {x: 0, y: 630},
                    {x: 0, y: 570}
                ],
                grassgroup1 = [
                    {x: 0, y: 550},
                    {x: 0, y: 630},
                    {x: 0, y: 560},
                    {x: 0, y: 610},
                    {x: 0, y: 630},
                    {x: 0, y: 570}
                ],
                treegroup2 = [
                    {x: 0, y: 510},
                    {x: 0, y: 530},
                    {x: 0, y: 480},
                    {x: 0, y: 520},
                    {x: 0, y: 520},
                    {x: 0, y: 500}
                ],
                treegroup3 = [
                    {x: 0, y: 490},
                    {x: 0, y: 480},
                    {x: 0, y: 460},
                    {x: 0, y: 440},
                    {x: 0, y: 480},
                    {x: 0, y: 460},
                    {x: 0, y: 400},
                    {x: 0, y: 400},
                    {x: 0, y: 400}
                ],
                treegroup4 = [
                    {x: 0, y: 430},
                    {x: 0, y: 360},
                    {x: 0, y: 430},
                    {x: 0, y: 395},
                    {x: 0, y: 415},
                    {x: 0, y: 400},
                    {x: 0, y: 400},
                    {x: 0, y: 410},
                    {x: 0, y: 400},
                    {x: 0, y: 400},
                    {x: 0, y: 400}
                ];
                
//private

            /**
             * draw using one canvas
             */
            function draw() {
                var i = 4,
                    img,
                    pattern,
                    num;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (i; i > -1; i -= 1) {
                    img = imgList[i][frame];
                    pattern = ctx.createPattern(img, 'repeat-x');
                    ctx.fillStyle = pattern;
                    ctx.rect(0, 0, canvas.width, canvas.height);
                    ctx.fill();
                    //ctx.drawImage(img, 0, 0);
                }
            }

            function parallax() {
                var i = 0,
                    item,
                    offset,
                    parallaxitems;

                parallaxitems = rotated ? parallaxGroupB : parallaxGroupA;

                for (i; i < parallaxitems.length; i += 1) {
                    item = parallaxitems[i];
                    offset = $(parallaxitems[i]).data('offset');
                    CSS3Helper.setTransform(item, 'translate(' + (delta.x * offset) + 'px, 0px)');
                }
            }

            function updateTerrain() {
                if (frame > goalFrame) {
                    frame -= 1;
                } else if (frame < goalFrame) {
                    frame += 1;
                } else {
                    return;
                }

                draw();
                setTimeout(updateTerrain, 20);
            }

            function setupImageList() {
                var i = 0,
                    num = 0,
                    j, 
                    arr;

                for (i; i < 5; i += 1) {
                    j = 0;
                    arr = [];
                    for (j; j < 10; j += 1) {
                        arr.push(AssetModel.groundA[num].img);
                        num += 1;
                    }
                    imgList.push(arr);
                }
            }

            function addTrees(s, shape, color, count, cl, treey, dist, group) {
                var i, treex, tree;

                for (i = 0; i < count; i += 1) {
                    treex = (i + 1) * dist;
                    tree = s.append('path');
                    tree.attr('d', shape);
                    tree.attr('transform', "translate(" + treex + "," + treey + ")");
                    tree.attr('fill', color);
                    tree.attr('class', cl);
                    tree.attr("data-from", tree.attr('transform'));
                    tree.attr("data-to", "translate(" + treex + "," + group[i].y + ")");
                    trees.push(tree);
                }
            }
            
            function setupSVG() {
                var i, j,
                    tree, treex, bush, bushx, svg, rects = [], rect, shape;

                $('#parallaxB').append(scenery_svg);
                
                //create animated svg
                svg = d3.select("#parallaxA").append("svg");
                svg.attr("width", 4435).attr("height", 1200);
                svg.attr("class", "scene-svg");
                
                //level 4
                parallaxGroup[0] = svg.append('g');
                parallaxGroup[0].attr('class', 'parallax-item');
                parallaxGroup[0].attr('data-offset', '4');

                clipGroup[0] = parallaxGroup[0].append('rect');
                clipGroup[0].attr('class', 'hills0');
                clipGroup[0].attr('width', 4435);
                clipGroup[0].attr('height', 768);
                clipGroup[0].attr('fill', '#e6e6e6');
                clipGroup[0].attr('data-from', 'M4435,768V440c-4.152,0.44-8.736,0-13.879,0c-47.658,0-47.658,0-95.316,0s-47.658,0-95.315,0s-47.657,0-95.315,0s-47.658,0-95.316,0s-47.658,0-95.316,0s-47.658,0-95.316,0s-47.658,0-95.317,0c-47.658,0-47.658,0-95.316,0c-47.657,0-47.657,0-95.315,0s-47.658,0-95.315,0c-47.658,0-47.658,0-95.316,0s-47.658,0-95.316,0s-47.658,0-95.316,0c-47.659,0-47.659,0-95.317,0s-47.658,0-95.316,0c-47.655,0-47.655,0-95.311,0c-47.656,0-47.656,0-95.312,0c-47.657,0-47.657,0-95.313,0c-47.658,0-47.658,0-95.315,0c-47.659,0-47.659,0-95.317,0s-47.658,0-95.317,0c-47.658,0-47.658,0-95.316,0c-47.657,0-47.657,0-95.314,0s-47.657,0-95.314,0s-47.657,0-95.314,0c-47.659,0-47.659,0-95.319,0c-47.657,0-47.657,0-95.314,0c-47.659,0-47.659,0-95.318,0c-47.658,0-47.658,0-95.315,0c-47.658,0-47.658,0-95.316,0c-47.659,0-47.659,0-95.317,0s-47.659,0-95.317,0c-47.658,0-47.658,0-95.317,0c-47.66,0-47.66,0-95.32,0c-47.659,0-47.659,0-95.318,0c-47.659,0-47.659,0-95.318,0c-47.66,0-47.66,0-95.32,0s-47.66,0-95.32,0s-47.66,0-95.32,0c-47.659,0-47.659,0-95.318,0c-47.66,0-47.66,0-95.319,0c-47.658,0-47.658,0-95.317,0c-47.661,0-47.661,0-95.321,0c-47.66,0-47.66,0-95.319,0c-47.66,0-47.66,0-95.321,0c-47.66,0-47.66,0-95.319,0C19.906,440,11.33,440,0,440v328H4435z');
                clipGroup[0].attr('data-to', 'M4435,768V359.192c-4.152,0.44-8.736,0.688-13.879,0.688c-47.658,0-47.658-7.216-95.316-7.216s-47.658-15.816-95.315-15.816s-47.657,21.401-95.315,21.401s-47.658-17.703-95.316-17.703s-47.658,18.16-95.316,18.16s-47.658,2.097-95.316,2.097s-47.658-10.104-95.317-10.104c-47.658,0-47.658-15.372-95.316-15.372c-47.657,0-47.657,1.202-95.315,1.202s-47.658,16.684-95.315,16.684c-47.658,0-47.658,5.121-95.316,5.121s-47.658-0.747-95.316-0.747s-47.658-3.859-95.316-3.859c-47.659,0-47.659-10.189-95.317-10.189s-47.658,8.807-95.316,8.807c-47.655,0-47.655-0.307-95.311-0.307c-47.656,0-47.656-24.248-95.312-24.248c-47.657,0-47.657,11.411-95.313,11.411c-47.658,0-47.658-3.672-95.315-3.672c-47.659,0-47.659,7.667-95.317,7.667s-47.658-9.428-95.317-9.428c-47.658,0-47.658,17.937-95.316,17.937c-47.657,0-47.657-9.5-95.314-9.5s-47.657,23.309-95.314,23.309s-47.657-14.221-95.314-14.221c-47.659,0-47.659-12.411-95.319-12.411c-47.657,0-47.657-2.271-95.314-2.271c-47.659,0-47.659,13.285-95.318,13.285c-47.658,0-47.658-15.417-95.315-15.417c-47.658,0-47.658,32.384-95.316,32.384c-47.659,0-47.659-18.805-95.317-18.805s-47.659,11.379-95.317,11.379c-47.658,0-47.658-1.325-95.317-1.325c-47.66,0-47.66,5.394-95.32,5.394c-47.659,0-47.659-34.92-95.318-34.92c-47.659,0-47.659,29.183-95.318,29.183c-47.66,0-47.66-21.984-95.32-21.984s-47.66,25.9-95.32,25.9s-47.66-12.704-95.32-12.704c-47.659,0-47.659-9.984-95.318-9.984c-47.66,0-47.66-6.714-95.319-6.714c-47.658,0-47.658,33.977-95.317,33.977c-47.661,0-47.661-24.904-95.321-24.904c-47.66,0-47.66,18.162-95.319,18.162c-47.66,0-47.66-28.072-95.321-28.072c-47.66,0-47.66,15.142-95.319,15.142c-16.642,0-27.47,1.757-36.548,4.043v768H4435z');
                clipGroup[0].attr('clip-path', 'url(#clip0)');

                clips[0] = svg.append('clipPath').attr('id', 'clip0');
                paths[0] = clips[0].append('path').attr('d', clipGroup[0].attr('data-from'));

                //level 3
                parallaxGroup[1] = svg.append('g');
                parallaxGroup[1].attr('class', 'parallax-item');
                parallaxGroup[1].attr('data-offset', '3');

                addTrees(parallaxGroup[1],
                    "M10.235-23.439c-1.826-4.41-7.749-5.887-12.721-4.863c-11.32,2.332-7.754,20.451,2.409,18.705C-0.265-6.135-0.852-2.717-1.216,0.75c-0.314,3.016,4.388,2.984,4.7,0C3.863-2.871,4.481-6.416,4.64-10.025c0.864-0.082,1.753-0.393,2.627-1.02C11.455-14.053,12.692-19.926,10.235-23.439z",
                    "#D5D5D5", 8, "trees1", 450, 550, treegroup4);

                //mountains
                clipGroup[1] = parallaxGroup[1].append('rect');
                clipGroup[1].attr('class', 'hills1');
                clipGroup[1].attr('width', 4435).attr('height', 768);
                clipGroup[1].attr('fill', '#d5d5d5');
                clipGroup[1].attr('data-from', 'M4402.739,450c-23.917,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.835,0s-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.836,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.836,0s-23.918,0-47.835,0s-23.917,0-47.835,0s-23.918,0-47.836,0s-23.918,0-47.835,0c-23.919,0-23.919,0-47.837,0s-23.918,0-47.835,0c-23.919,0-23.919-1.193-47.837-1.193S3374.281,450,3350.364,450c-23.919,0-23.919,0-47.837,0s-23.918,0-47.835,0c-23.918,0-23.918,0-47.836,0c-23.917,0-23.917,0-47.835,0s-23.918,0-47.836,0s-23.918,0-47.836,0s-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0s-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0s-23.918,0-47.837,0c-23.918,0-23.918,0-47.836,0c-23.917,0-23.917,0-47.833,0c-23.915,0-23.915,0-47.83,0c-23.917,0-23.917,0-47.834,0c-23.916,0-23.916,0-47.833,0c-23.915,0-23.915,0-47.831,0c-23.918,0-23.918,0-47.835,0s-23.917,0-47.833,0s-23.916,0-47.832,0c-23.919,0-23.919,0-47.838,0c-23.916,0-23.916,0-47.832,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.835,0c-23.916,0-23.916,0-47.833,0c-23.919,0-23.919,0-47.838,0c-23.917,0-23.917,0-47.833,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.834,0c-23.919,0-23.919,0-47.838,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.918,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.835,0c-23.919,0-23.919,0-47.838,0c-23.918,0-23.918,0-47.835,0c-23.918,0-23.918,0-47.836,0c-23.92,0-23.919,0-47.839,0c-23.918,0-23.918,0-47.837,0c-23.918,0-23.918,0-47.836,0s-23.918,0-47.836,0s-23.918,0-47.837,0c-23.919,0-23.919,0-47.839,0c-23.92,0-23.92,0-47.839,0s-23.919,0-47.839,0c-23.919,0-23.919,0-47.839,0c-23.919,0-23.919,0-47.838,0s-23.919,0-47.838,0s-23.919,0-47.837,0c-23.92,0-23.92,0-47.84,0c-23.919,0-23.919,0-47.838,0c-23.92,0-23.92,0-47.839,0s-23.919,0-47.838,0c-23.919,0-23.919,0-47.839,0c-23.92,0-23.92,0-47.84,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.836,0c-23.92,0-23.92,0-47.841,0c-23.918,0-23.918,0-47.837,0c-23.919,0-23.919,0-47.839,0c-23.918,0-23.918,0-47.837,0c-23.919,0-23.919,0-47.839,0s-23.919,0-47.839,0c-23.921,0-23.921,0-47.842,0s-23.921,0-47.842,0c-23.92,0-23.92,0-47.841,0c-23.921,0-23.921,0-47.843,0c-23.92,0-23.92,0-47.84,0c-0.616,0-1.212-0.076-1.797,0v318h4435v450c4423.999,450,4419.927,450,4402.739,450z');
                clipGroup[1].attr('data-to', 'M4402.739,409.892c-23.917,0-23.917-16.267-47.835-16.267c-23.917,0-23.917,25.312-47.834,25.312c-23.918,0-23.918-54.833-47.835-54.833s-23.917,48.942-47.835,48.942c-23.917,0-23.917-91.232-47.834-91.232c-23.918,0-23.918,112.102-47.837,112.102c-23.917,0-23.917-98.037-47.835-98.037c-23.917,0-23.917,24.844-47.834,24.844c-23.918,0-23.918,34.378-47.837,34.378c-23.917,0-23.917-90.226-47.835-90.226c-23.917,0-23.917,44.382-47.834,44.382c-23.918,0-23.918,84.521-47.836,84.521c-23.917,0-23.917-33.216-47.834-33.216c-23.918,0-23.918-85.547-47.836-85.547s-23.918,96.386-47.835,96.386s-23.917-47.061-47.835-47.061s-23.918,65.458-47.836,65.458s-23.918-37.603-47.835-37.603c-23.919,0-23.919-18.963-47.837-18.963s-23.918,60.041-47.835,60.041c-23.919,0-23.919,15.533-47.837,15.533s-23.918-31.13-47.835-31.13c-23.919,0-23.919-103.016-47.837-103.016s-23.918,99.299-47.835,99.299c-23.918,0-23.918-16.29-47.836-16.29c-23.917,0-23.917-72.287-47.835-72.287s-23.918,104.572-47.836,104.572s-23.918,0.727-47.836,0.727s-23.918-112.816-47.837-112.816c-23.917,0-23.917,93.445-47.835,93.445s-23.918-63.646-47.837-63.646c-23.917,0-23.917,76.929-47.835,76.929s-23.918-47.853-47.837-47.853c-23.918,0-23.918,59.188-47.836,59.188c-23.917,0-23.917-34.322-47.833-34.322c-23.915,0-23.915,22.663-47.83,22.663c-23.917,0-23.917-2.019-47.834-2.019c-23.916,0-23.916-77.129-47.833-77.129c-23.915,0-23.915,57.779-47.831,57.779c-23.918,0-23.918,21.823-47.835,21.823s-23.917-65.511-47.833-65.511s-23.916,89.524-47.832,89.524c-23.919,0-23.919-31.635-47.838-31.635c-23.916,0-23.916,22.956-47.832,22.956c-23.917,0-23.917-86.899-47.834-86.899c-23.918,0-23.918,41.763-47.835,41.763c-23.916,0-23.916-74.859-47.833-74.859c-23.919,0-23.919,122.481-47.838,122.481c-23.917,0-23.917-43.182-47.833-43.182c-23.918,0-23.918-53.135-47.837-53.135c-23.917,0-23.917,87.116-47.834,87.116c-23.918,0-23.918-41.411-47.837-41.411c-23.917,0-23.917,25.549-47.834,25.549c-23.919,0-23.919-95.072-47.838-95.072c-23.917,0-23.917,107.309-47.834,107.309c-23.918,0-23.918-89.945-47.837-89.945c-23.918,0-23.917,105.822-47.835,105.822c-23.917,0-23.917-30.711-47.835-30.711c-23.919,0-23.919-80.547-47.838-80.547c-23.918,0-23.918,62.859-47.835,62.859c-23.918,0-23.918-91.01-47.836-91.01c-23.92,0-23.919,106.433-47.839,106.433c-23.918,0-23.918-28.378-47.837-28.378c-23.918,0-23.918,40.077-47.836,40.077s-23.918-103.779-47.836-103.779s-23.918,105.795-47.837,105.795c-23.919,0-23.919-18.489-47.839-18.489c-23.92,0-23.92,9.5-47.839,9.5s-23.919-57.052-47.839-57.052c-23.919,0-23.919,44.183-47.839,44.183c-23.919,0-23.919-72.319-47.838-72.319s-23.919,92.194-47.838,92.194s-23.919-111.578-47.837-111.578c-23.92,0-23.92,108.041-47.84,108.041c-23.919,0-23.919-42.549-47.838-42.549c-23.92,0-23.92,2.34-47.839,2.34s-23.919-68.62-47.838-68.62c-23.919,0-23.919,93.136-47.839,93.136c-23.92,0-23.92-51.614-47.84-51.614c-23.917,0-23.917,69.081-47.834,69.081c-23.918,0-23.918,6.511-47.836,6.511c-23.92,0-23.92-61.143-47.841-61.143c-23.918,0-23.918,44.471-47.837,44.471c-23.919,0-23.919-94.331-47.839-94.331c-23.918,0-23.918,91.588-47.837,91.588c-23.919,0-23.919,6.229-47.839,6.229s-23.919-82.778-47.839-82.778c-23.921,0-23.921,63.681-47.842,63.681s-23.921,1.675-47.842,1.675c-23.92,0-23.92-71.316-47.841-71.316c-23.921,0-23.921,71.247-47.843,71.247c-23.92,0-23.92-30.831-47.84-30.831c-0.616,0-1.212,0.048-1.797,0.124v768h4435v321.666c4424.764,353.439,4419.927,409.892,4402.739,409.892z');
                clipGroup[1].attr('clip-path', 'url(#clip1)');

                clips[1] = svg.append('clipPath').attr('id', 'clip1');
                paths[1] = clips[1].append('path').attr('d', clipGroup[1].attr('data-from'));

                //level 2
                parallaxGroup[2] = svg.append('g');
                parallaxGroup[2].attr('class', 'parallax-item');
                parallaxGroup[2].attr('data-offset', '2');

                for (i = 0; i < 8; i += 1) {
                    treex = (i + 1) * 650;
                    tree = parallaxGroup[2].append('path');
                    if (i % 2 === 0) {
                        tree.attr('d', 'M12.852-30.875c-2.34-5.649-9.929-7.542-16.299-6.229c-14.504,2.987-9.935,26.201,3.087,23.965C-0.602-8.704-1.354-4.324-1.82,0.118c-0.403,3.862,5.621,3.822,6.021,0c0.486-4.641,1.278-9.181,1.48-13.807c1.107-0.105,2.246-0.502,3.366-1.305C14.414-18.848,15.999-26.373,12.852-30.875z');
                    } else {
                        tree.attr('d', 'M14.002-16.395c-3.099-0.44-5.308-2.521-7.754-4.297c-0.125-0.091-0.246-0.137-0.369-0.193c-0.012-0.289-0.086-0.577-0.21-0.85c-0.001-0.766-0.028-1.533-0.062-2.299c0.91,0.609,1.873,1.146,2.883,1.594c1.126,0.498,2.42,0.34,3.094-0.812c0.569-0.973,0.316-2.596-0.812-3.094c-2.409-1.066-4.585-2.539-5.964-4.83c-0.158-0.828-0.326-1.658-0.537-2.488c-0.715-2.828-5.079-1.629-4.361,1.2c0.103,0.407,0.175,0.811,0.265,1.214c-0.337,0.186-0.626,0.45-0.79,0.814c-1.041,2.287-3.011,3.678-4.926,5.197c-0.967,0.769-0.796,2.402,0,3.198c0.946,0.946,2.234,0.767,3.199,0c1.193-0.946,2.383-1.886,3.42-2.962c0.061,0.9,0.104,1.801,0.119,2.699c-3.215,1.662-6.391,3.382-9.887,4.4c-2.795,0.812-1.605,5.179,1.201,4.361c2.998-0.871,5.789-2.207,8.547-3.617c-0.088,1.377-0.207,2.756-0.362,4.135c-0.557-0.147-1.155-0.1-1.632,0.25c-0.896,0.656-1.979,1.478-3.158,1.279c-1.215-0.203-2.43,0.301-2.783,1.58c-0.301,1.096,0.363,2.579,1.582,2.782c1.967,0.329,3.71-0.027,5.352-0.921C-0.357-5.17-0.82-2.276-1.221,0.643c-0.395,2.852,3.966,4.082,4.361,1.201c0.422-3.06,0.9-6.098,1.326-9.123c1.02,0.451,2.211,0.593,3.279,0.606c2.918,0.036,2.916-4.487,0-4.524c-0.164,0-0.327-0.005-0.49-0.012c-0.088-0.005-0.147-0.006-0.188-0.006c-0.034-0.006-0.062-0.013-0.116-0.021c-0.209-0.037-0.414-0.097-0.615-0.16c-0.021-0.008-0.029-0.008-0.046-0.014c-0.026-0.018-0.067-0.044-0.146-0.088c-0.062-0.041-0.07-0.045-0.098-0.061c-0.127-0.113-0.244-0.234-0.356-0.359c0.297,0.336-0.11-0.231-0.13-0.266c-0.039-0.071-0.068-0.115-0.087-0.148c-0.009-0.038-0.026-0.097-0.071-0.221c-0.057-0.162-0.131-0.315-0.213-0.459c0.095-0.895,0.177-1.789,0.249-2.684c2.239,1.664,4.484,3.253,7.361,3.662c1.22,0.174,2.425-0.277,2.782-1.58C15.879-14.685,15.226-16.221,14.002-16.395z');
                    }
                    tree.attr('transform', "translate(" + treex + "," + 490 + ')');
                    tree.attr('fill', "#C2C2C2");
                    tree.attr("class", "trees2");
                    tree.attr("data-from", tree.attr('transform'));
                    tree.attr("data-to", "translate(" + treex + "," + treegroup3[i].y + ')');
                    trees.push(tree);
                }

                clipGroup[2] = parallaxGroup[2].append('g');
                rect = clipGroup[2].append('rect');
                rect.attr('class', 'hills2');
                rect.attr('width', 4435).attr('height', 768);
                rect.attr('fill', '#c2c2c2');
                clipGroup[2].attr('data-from', 'M4338.957,485c-88.047,0-88.047,0-176.093,0c-88.048,0-88.048,0-176.095,0c-88.046,0-88.046,0-176.092,0c-88.047,0-88.047,0-176.094,0s-88.047,0-176.095,0c-88.044,0-88.044,0-176.088,0c-88.046,0-88.046,0-176.091,0s-88.045,0-176.091,0c-88.045,0-88.045,0-176.09,0c-88.048,0-88.048,0-176.096,0c-88.046,0-88.046,0-176.092,0s-88.046,0-176.092,0c-88.048,0-88.048,0-176.096,0c-88.047,0-88.047,0-176.095,0c-88.047,0-88.047,0-176.094,0s-88.047,0-176.095,0s-88.048,0-176.096,0s-88.048,0-176.097,0c-88.047,0-88.047,0-176.095,0c-88.046,0-88.046,0-176.093,0c-88.048,0-88.048,0-176.095,0c-88.049,0-88.049,0-176.098,0c-88.048,0-88.048,0-176.096,0c-88.052,0-88.052,0-176.104,0C52.287,485,35.33,485,0,485v283h4435v485C4412,485,4388.822,485,4338.957,485z');
                clipGroup[2].attr('data-to', 'M4338.957,439.62c-88.047,0-88.047,44-176.093,44c-88.048,0-88.048-44-176.095-44c-88.046,0-88.046,44-176.092,44c-88.047,0-88.047-44-176.094-44s-88.047,44-176.095,44c-88.044,0-88.044-44-176.088-44c-88.046,0-88.046,44-176.091,44s-88.045-44-176.091-44c-88.045,0-88.045,44-176.09,44c-88.048,0-88.048-44-176.096-44c-88.046,0-88.046,44-176.092,44s-88.046-44-176.092-44c-88.048,0-88.048,44-176.096,44c-88.047,0-88.047-44-176.095-44c-88.047,0-88.047,44-176.094,44s-88.047-44-176.095-44s-88.048,44-176.096,44s-88.048-44-176.097-44c-88.047,0-88.047,44-176.095,44c-88.046,0-88.046-44-176.093-44c-88.048,0-88.048,44-176.095,44c-88.049,0-88.049-44-176.098-44c-88.048,0-88.048,44-176.096,44c-88.052,0-88.052-44-176.104-44c-60.409,0-78.762,17.837-112.696,30.99v768h4435v463.415C4410.029,451.773,4388.822,439.62,4338.957,439.62z');
                clipGroup[2].attr('clip-path', 'url(#clip2)');
                clips[2] = svg.append('clipPath').attr('id', 'clip2');
                paths[2] = clips[2].append('path').attr('d', clipGroup[2].attr('data-from'));

                //level 1
                parallaxGroup[3] = svg.append('g');
                parallaxGroup[3].attr('class', 'parallax-item');
                parallaxGroup[3].attr('data-offset', '1');

                addTrees(parallaxGroup[3],
                        "M17.221-22.536c-3.978-0.565-6.813-3.237-9.953-5.516c-0.161-0.117-0.316-0.177-0.476-0.249c-0.015-0.37-0.109-0.74-0.269-1.091c-0.002-0.982-0.037-1.968-0.079-2.951c1.169,0.783,2.405,1.473,3.7,2.046c1.446,0.641,3.106,0.437,3.972-1.042c0.731-1.249,0.407-3.333-1.041-3.972c-3.094-1.369-5.886-3.26-7.657-6.201C5.215-42.575,5-43.641,4.729-44.707c-0.919-3.63-6.521-2.09-5.6,1.542c0.132,0.522,0.225,1.04,0.34,1.559c-0.433,0.238-0.804,0.577-1.015,1.046c-1.335,2.936-3.864,4.721-6.322,6.671c-1.242,0.987-1.022,3.084,0,4.106c1.214,1.215,2.868,0.983,4.106,0c1.531-1.215,3.059-2.422,4.39-3.802c0.079,1.155,0.133,2.311,0.153,3.464c-4.127,2.134-8.204,4.342-12.691,5.649c-3.589,1.044-2.062,6.648,1.542,5.6c3.848-1.119,7.431-2.834,10.973-4.644c-0.114,1.768-0.268,3.537-0.466,5.307c-0.715-0.188-1.482-0.128-2.095,0.321c-1.151,0.844-2.54,1.897-4.056,1.644c-1.56-0.261-3.119,0.385-3.571,2.028c-0.388,1.405,0.465,3.311,2.029,3.571c2.526,0.422,4.764-0.035,6.87-1.182c-0.531,3.7-1.124,7.415-1.64,11.163c-0.505,3.659,5.092,5.24,5.601,1.542C3.818-3.05,4.433-6.949,4.98-10.833c1.309,0.578,2.838,0.76,4.209,0.777c3.747,0.047,3.744-5.761,0-5.809c-0.21,0-0.42-0.006-0.629-0.015c-0.113-0.006-0.189-0.008-0.242-0.008c-0.044-0.008-0.078-0.016-0.149-0.026c-0.269-0.048-0.53-0.125-0.789-0.206c-0.028-0.01-0.037-0.01-0.06-0.018c-0.033-0.022-0.086-0.057-0.188-0.112c-0.08-0.054-0.09-0.058-0.125-0.078c-0.163-0.146-0.313-0.301-0.457-0.462c0.381,0.432-0.142-0.297-0.167-0.342c-0.051-0.091-0.087-0.147-0.111-0.189c-0.012-0.049-0.034-0.124-0.091-0.283c-0.074-0.208-0.168-0.405-0.274-0.59c0.122-1.148,0.228-2.297,0.32-3.445c2.875,2.137,5.757,4.177,9.45,4.702c1.565,0.224,3.112-0.356,3.572-2.028C19.63-20.341,18.792-22.312,17.221-22.536z",
                        "#CDCDCD", 5, "trees3", 550, 800, treegroup2);

                clipGroup[3] = parallaxGroup[3].append('rect');
                clipGroup[3].attr('class', 'hills3');
                clipGroup[3].attr('width', 4435).attr('height', 1200);
                clipGroup[3].attr('fill', '#cdcdcd');
                clipGroup[3].attr('data-from', 'M4415.31,550c-36.226,0-36.226,0-72.451,0c-36.228,0-36.228,0-72.454,0s-36.227,0-72.452,0c-36.225,0-36.225,0-72.449,0c-36.224,0-36.224,0-72.447,0s-36.224,0-72.446,0c-36.226,0-36.226,0-72.451,0s-36.226,0-72.451,0c-36.227,0-36.227,0-72.453,0c-36.225,0-36.225,0-72.449,0c-36.226,0-36.226,0-72.451,0s-36.226,0-72.451,0c-36.225,0-36.225,0-72.449,0s-36.225,0-72.45,0s-36.226,0-72.451,0c-36.224,0-36.224,0-72.448,0c-36.226,0-36.226,0-72.451,0c-36.225,0-36.225,0-72.449,0c-36.224,0-36.224,0-72.447,0c-36.225,0-36.225,0-72.448,0c-36.226,0-36.226,0-72.45,0c-36.226,0-36.226,0-72.451,0c-36.225,0-36.225,0-72.45,0s-36.226,0-72.45,0c-36.224,0-36.224,0-72.447,0c-33.936,0-33.936,0-65.999,0h-25.988c-18.458-1.898-24.715,0-52.904,0c-36.224,0-36.224,0-72.446,0c-36.226,0-36.226,0-72.451,0c-36.223,0-36.223,0-72.445,0s-36.223,0-72.444,0c-36.225,0-36.225,0-72.449,0c-36.222,0-36.222,0-72.444,0s-36.223,0-72.444,0c-36.224,0-36.224,0-72.448,0c-36.221,0-36.221,0-72.442,0c-36.225,0-36.225,0-72.448,0c-36.225,0-36.225,0-72.449,0s-36.225,0-72.449,0s-36.225,0-72.449,0c-36.224,0-36.224,0-72.448,0s-36.225,0-72.45,0c-36.225,0-36.225,0-72.449,0c-36.224,0-36.224,0-72.448,0c-36.224,0-36.224,0-72.448,0c-36.223,0-36.223,0-72.447,0c-36.224,0-36.224,0-72.447,0c-36.225,0-36.225,0-72.449,0c-36.224,0-36.224,0-72.448,0c-36.224,0-36.224,0-72.447,0s-36.224,0-72.447,0c-36.225,0-36.225,0-72.45,0c-36.223,0-36.223,0-72.447,0s-36.224,0-72.447,0c-36.225,0-36.225,0-72.449,0c-36.224,0-36.224,2.319-72.447,2.319c-36.224,0-36.224-2.319-72.448-2.319s-36.224,0-72.447,0c-36.223,0-36.223,0-72.446,0c-36.225,0-36.225,0-72.449,0C33.59,550,32.187,550.497,0,550v115.062c0.854,0.11,1.688,0.254,2.5,0.433v900H4435v550c4429.709,553.309,4423.42,550,4415.31,550z');
                clipGroup[3].attr('data-to', 'M4415.31,508.805c-36.226,0-36.226-1.164-72.451-1.164c-36.228,0-36.228-75.227-72.454-75.227s-36.227,58.66-72.452,58.66c-36.225,0-36.225,17.828-72.449,17.828c-36.224,0-36.224-41.573-72.447-41.573s-36.224,63.387-72.446,63.387c-36.226,0-36.226-22.549-72.451-22.549s-36.226-50.593-72.451-50.593c-36.227,0-36.227,64.79-72.453,64.79c-36.225,0-36.225-15.476-72.449-15.476c-36.226,0-36.226,21.003-72.451,21.003s-36.226-51.958-72.451-51.958c-36.225,0-36.225-28.154-72.449-28.154s-36.225,61.208-72.45,61.208s-36.226-28.855-72.451-28.855c-36.224,0-36.224,14.457-72.448,14.457c-36.226,0-36.226-56.692-72.451-56.692c-36.225,0-36.225,76.073-72.449,76.073c-36.224,0-36.224-35.474-72.447-35.474c-36.225,0-36.225,33.451-72.448,33.451c-36.226,0-36.226-59.554-72.45-59.554c-36.226,0-36.226,68.312-72.451,68.312c-36.225,0-36.225-101.008-72.45-101.008s-36.226,105.456-72.45,105.456c-36.224,0-36.224-71.711-72.447-71.711c-33.936,0-36.079,67.972-65.999,76.558h-25.988c-18.458-1.898-24.715-6.178-52.904-6.178c-36.224,0-36.224-51.916-72.446-51.916c-36.226,0-36.226,56.114-72.451,56.114c-36.223,0-36.223-86.871-72.445-86.871s-36.223,70.069-72.444,70.069c-36.225,0-36.225-0.327-72.449-0.327c-36.222,0-36.222-25.188-72.444-25.188s-36.223,33.359-72.444,33.359c-36.224,0-36.224-87.687-72.448-87.687c-36.221,0-36.221,88.12-72.442,88.12c-36.225,0-36.225-86.808-72.448-86.808c-36.225,0-36.225,84.146-72.449,84.146s-36.225,12.863-72.449,12.863s-36.225-53.295-72.449-53.295c-36.224,0-36.224,46.221-72.448,46.221s-36.225-67.538-72.45-67.538c-36.225,0-36.225,72.631-72.449,72.631c-36.224,0-36.224-0.189-72.448-0.189c-36.224,0-36.224-52.513-72.448-52.513c-36.223,0-36.223,45.317-72.447,45.317c-36.224,0-36.224-18.216-72.447-18.216c-36.225,0-36.225,41.267-72.449,41.267c-36.224,0-36.224-61.845-72.448-61.845c-36.224,0-36.224,27.69-72.447,27.69s-36.224-70.554-72.447-70.554c-36.225,0-36.225,97.119-72.45,97.119c-36.223,0-36.223-44.567-72.447-44.567s-36.224,31.201-72.447,31.201c-36.225,0-36.225-16.198-72.449-16.198c-36.224,0-36.224,46.09-72.447,46.09c-36.224,0-36.224-37.428-72.448-37.428s-36.224-53.36-72.447-53.36c-36.223,0-36.223,95.263-72.446,95.263c-36.225,0-36.225-40.343-72.449-40.343c-34.805,0-36.208-6.348-68.395-6.845v155.456c0.854,0.11,1.688,0.254,2.5,0.433v900H4435v503.358c4429.709,506.667,4423.42,508.805,4415.31,508.805z');
                clipGroup[3].attr('clip-path', 'url(#clip3)');
                clips[3] = svg.append('clipPath').attr('id', 'clip3');
                paths[3] = clips[3].append('path').attr('d', clipGroup[3].attr('data-from'));

                //level 0
                addTrees(svg,
                    "M5,2c0,0,93.12,2.975,93,0s-0.197-4.915-0.197-4.915l-1.73-26.325L93.762-3H93.76l-3.117-32.64L89.724-3h-0.001l-2.268-34.434L86.037-2.84l-0.341,0.023l-2.479-37.789L81.664-3h-0.005l-2.413-29.424L77.632-3h-0.009l-3.092-22.589L73.602-3h-0.009l-3.004-24.684L69.573-3h-0.007l-2.147-32.718L65.548-3h-0.015l-2.663-20.148L61.523-3h-0.012l-2.47-37.64L57.499-3H57.49l-1.74-29.776L53.474-2h-0.01l-0.728-32.979L49.449-2h-0.02l-2.47-37.61L45.415-2h-0.014l-2.468-37.601L41.388-2h-0.014l-2.093-31.875L37.362-2h-0.023l-2.84-28.319L33.335-2h-0.022l-2.875-27.467L29.308-2h-0.022l-3.091-32.417L25.28-2h-0.016l-2.462-37.553L21.259-2h-0.026l-2.839-28.281L17.23-2h-0.045l-6.429-33.36l2.429,33.309l-0.489-0.01L6.149-31.9l2.4,27.978l-8.958-29.881L5.114-2H5V2z",
                    "#B3B3B3", 5, "bush5", 630, 700, grassgroup1);

                addTrees(svg,
                    "M78.493-16.285c-1.943-4.816-5.041-8.356-10.682-9.364c-3.667-0.656-7.408,0.875-10.599,3.074c-1.427-1.894-3.296-3.432-5.806-4.542c-1.25-0.552-2.59-0.855-3.965-0.957c-4.92-2.666-10.119,0.291-14.104,4.496c-0.727-1.333-2.426-2.288-3.854-2.378c-0.083-0.006-0.167-0.008-0.252-0.012c-1.937-4.766-6.815-4.943-11.983-3.272c-6.039,1.953-8.286,7.591-8.114,13.235c-1.697,0.244-3.389,0.558-5.073,0.97c-4.188,1.024-5.6,6.287-2.017,8.992c4.075,3.079,8.221,3.356,12.446,2.737c0.276,0.075,0.562,0.138,0.869,0.164c3.938,0.338,7.884,0.55,11.833,0.626c1.29,0.132,2.582,0.268,3.872,0.402c7.37,0.772,14.739,1.562,22.146,1.899c9.668,0.439,26.446,1.354,29.146-10.891C82.954-13.816,80.866-15.743,78.493-16.285z",
                    "#B3B3B3", 5, "bush5", 630, 1200, bushgroup1);

                addTrees(svg,
                    "M26.264-41.37c-7.633,5.514-16.112,7.224-24.542,8.571c0.052-1.958,0.119-3.915,0.195-5.873c7.101-1.348,14.096-4.554,20.682-8.355c3.013-1.739,1.695-8.704-1.363-6.938C15.22-50.492,8.75-47.318,2.24-45.946c0.091-1.855,0.188-3.713,0.289-5.568c5.33-0.973,10.326-4.083,15.453-6.307c3.15-1.365,1.807-8.312-1.362-6.938c-4.511,1.954-8.999,4.854-13.693,5.929c0.124-2.273,0.245-4.547,0.36-6.821c2.581-0.18,5.096-0.933,7.518-2.244c1.303-0.704,2.189-2.392,1.791-4.425c-0.344-1.749-1.85-3.22-3.154-2.513c-1.907,1.031-3.818,1.717-5.824,1.943c0.076-1.894,0.156-3.787,0.211-5.681C3.88-78.567,4-78.561,4-78.561c3,0,3-7.195,0-7.195c0,0-0.026,0.002-0.033,0.002c0.007-0.721,0.008-1.44,0.011-2.16c0.011-4.641-5.12-4.641-5.132,0c-0.002,1.229-0.018,2.461-0.034,3.691c-0.966-0.48-1.958-0.783-3.046-0.813c-1.397-0.039-2.563,1.666-2.563,3.598c0,1.99,1.166,3.56,2.563,3.599c0.031,0,0.467,0.047,0.516,0.034c0.23,0.062,0.462,0.146,0.687,0.239c0.126,0.057,0.252,0.118,0.376,0.185c0.242,0.153,0.479,0.322,0.717,0.489c0.183,0.129,0.373,0.221,0.564,0.295c-0.051,1.501-0.106,3.003-0.169,4.506c-2.724-0.656-5.438-1.378-8.163-2.022c-3.233-0.765-4.619,6.169-1.363,6.938c2.91,0.689,5.808,1.471,8.718,2.159c0.164,0.038,0.322,0.053,0.477,0.054c-0.083,1.633-0.169,3.264-0.257,4.896c-4.508-1.018-8.835-3.277-13.383-4.102c-3.274-0.593-3.232,6.61,0,7.196c4.407,0.798,8.615,2.958,12.996,4.016c-0.09,1.634-0.178,3.268-0.262,4.9c-5.296-2.491-10.041-6.535-15.812-6.758c-3.31-0.126-3.3,7.069,0,7.196c5.542,0.213,10.276,4.741,15.464,6.952c-0.066,1.594-0.13,3.188-0.183,4.781c-5.372-3.889-11.254-6.648-17.163-8.007c-3.234-0.744-4.621,6.19-1.363,6.938c6.41,1.474,12.696,4.576,18.336,9.127c-0.102,8.036,0.084,16.07,0.806,24.103c0.407,4.54,5.54,4.596,5.128,0c-0.654-7.285-0.867-14.573-0.826-21.861c9.396-1.502,18.722-3.414,27.246-9.572C31.792-37.281,29.197-43.49,26.264-41.37z",
                    "#B3B3B3", 10, "trees5", 630, 500, treegroup1);

                clipGroup[4] = svg.append('g');
                rect = clipGroup[4].append('rect');
                rect.attr('class', 'hills4');
                rect.attr('width', 4435).attr('height', 1200);
                rect.attr('fill', '#808080');

                shape = clipGroup[4].append('path');
                shape.attr('d', 'M439.14,611.343c0-9.972-8.891-20.37-19.5-19.5c-36.901,3.025-192.244,13.898-193.157,13.775c-1.903-0.31-26.726,1.85-29.667,12.542c-2.691,9.784,3.221,21.773,13.62,23.987c14.481,3.082,29.217,3.609,43.95,4.316c3.284,0.158,6.565,0.371,9.842,0.643c0.407,0.034,0.814,0.077,1.221,0.116c1.318,7.181,6.509,13.772,13.994,15.927c35.438,10.197,71.447-2.092,107.194-2.304c10.629-0.063,19.5-8.822,19.5-19.5c0-0.359-0.036-0.711-0.055-1.066c0.901-0.92,1.791-1.861,2.672-2.825c1.008-1.103,2.055-2.162,3.137-3.191c0.148-0.142,0.339-0.311,0.538-0.483c0.314-0.203,0.628-0.405,0.944-0.604c0.57-0.344,1.152-0.663,1.743-0.969c1.2-0.421,2.436-0.733,3.667-1.043c0.877-0.22,5.708-0.928,0.857-0.321C430.184,629.523,439.14,622.971,439.14,611.343z');
                shape.attr('fill', '#6e6e6e');
                shape.attr('class', 'hills5');

                shape = clipGroup[4].append('path');
                shape.attr('d', 'M1538.752,606.844c-19.921-0.021-196.881-60.336-408.752-84.344c-224.646-25.455-485.519-14.686-530.342-14.666c-10.631,0.005-19.5,8.866-19.5,19.5c0,10.626,8.869,19.505,19.5,19.5c44.773-0.021,89.544-1.411,134.316-0.418c22.887,0.508,45.764,1.701,68.539,4.029c5.154,0.526,10.299,1.141,15.438,1.802c0.162,0.022,0.318,0.044,0.514,0.071c1.744,0.242,3.485,0.502,5.227,0.763c2.891,0.431,5.773,0.902,8.656,1.384c10.799,1.806,21.525,4.043,32.152,6.675c3.219,0.797,6.484,0.786,9.543,0.077c6.504,0.892,12.973,1.945,19.412,3.127c3.088,1.293,6.186,2.564,9.289,3.817c24.365,9.842,49.408,17.896,74.096,26.871c2.862,1.041,5.718,2.102,8.57,3.171c1.136,0.427,2.271,0.857,3.406,1.29c-3.869-1.471,1.434,0.632,1.834,0.813c5.725,2.601,11.301,5.523,16.802,8.568c10.706,5.926,20.985,12.598,31.253,19.243c21.029,13.608,42.16,26.442,65.82,35.031c2.736,0.993,5.572,1.14,8.303,0.638c11.271,5.92,23.988,9.972,35.989,13.376c16.544,4.691,34.387,6.134,51.472,7.46c35.451,2.753,71.451,1.849,106.623-3.472c6.485-0.981,11.982-7.666,13.619-13.62c0.057-0.206,0.102-0.412,0.15-0.619c0.248-0.12,0.491-0.249,0.74-0.368c2.123-1.019,4.273-1.977,6.428-2.925c0.1-0.041,0.182-0.074,0.291-0.12c1.627-0.67,3.27-1.302,4.912-1.933c9.191-3.532,18.645-6.353,28.195-8.723c8.963-2.224,18.059-3.883,27.193-5.217c-0.607,0.105,4.215-0.528,4.873-0.605c2.849-0.33,5.704-0.606,8.561-0.87c5.15-0.477,10.312-0.817,15.477-1.104c40.44-2.247,80.944,0.755,121.4,0.797c10.63,0.011,19.5-8.879,19.5-19.5C1558.252,615.706,1549.382,606.854,1538.752,606.844z');
                shape.attr('fill', '#6e6e6e');
                shape.attr('class', 'hills5');

                shape = clipGroup[4].append('path');
                shape.attr('d', 'M1856.783,534.837c-12.212,0.056-56.449-6.252-96.783,1.601c-36.378,7.082-69.569,28.36-73.418,29.099c-10.445,2.004-16.267,14.361-13.619,23.987c2.983,10.846,13.559,15.621,23.988,13.62c1.502-0.289,3.008-0.544,4.516-0.796c0.172,0.007,3.616-0.479,3.799-0.498c4.367-0.462,8.76-0.673,13.146-0.83c7.893-0.284,15.797-0.156,23.691-0.196c16.042-0.081,32.062-1.542,47.582-5.769c11.228-3.059,21.812-7.987,32.598-12.269c5.604-2.225,11.305-4.17,17.121-5.764c2.965-0.812,5.971-1.461,8.986-2.052c1.336-0.263,2.68-0.479,4.025-0.69c-2.898,0.476,3.587-0.373,4.367-0.443c10.582-0.95,19.5-8.151,19.5-19.5C1876.283,543.744,1867.414,534.788,1856.783,534.837z');
                shape.attr('fill', '#6e6e6e');
                shape.attr('class', 'hills5');

                shape = clipGroup[4].append('path');
                shape.attr('d', 'M2735.871,594.843c-49.337-1.31-131.926-5.475-209.573-9.761c-93.897-5.183-180.567-10.542-192.467-11.241c-10.621-0.624-19.5,9.343-19.5,19.5c0,11.102,8.893,18.877,19.5,19.5c1.639,0.097,3.272,0.212,4.907,0.349c0.513,0.043,2.527,0.282,3.101,0.335c2.161,0.353,4.308,0.783,6.445,1.251c2.626,0.575,5.215,1.307,7.784,2.093c1.224,0.375,2.432,0.798,3.639,1.222c0.585,0.205,2.222,0.86,3.049,1.182c7.949,3.611,15.327,8.354,22.518,13.277c17.473,11.965,34.897,22.928,55.984,27.328c17.847,3.724,36.5,4.985,54.662,6.141c20.551,1.307,41.239,1.805,61.806,0.56c15.984-0.967,36.246-1.913,49.974-11.394c8.097-5.592,10.792-14.571,8.545-22.306c39.893,0.018,79.787-0.093,119.627,0.965c10.63,0.282,19.5-9.084,19.5-19.5C2755.371,603.5,2746.494,595.125,2735.871,594.843z');
                shape.attr('fill', '#6e6e6e');
                shape.attr('class', 'hills5');

                shape = clipGroup[4].append('path');
                shape.attr('d', 'M3590.957,585.842c-10.141-1.017-46.254-16.964-81.373-26.928c-31.321-8.888-61.852-11.789-72.459-14.38c-10.317-2.521-21.109,3.156-23.987,13.62c-2.755,10.018,3.297,21.465,13.62,23.987c1.238,0.303,2.454,0.648,3.667,1.041c0.275,0.089,0.66,0.235,1.061,0.396c2.046,0.987,4.021,2.121,5.954,3.307c1.791,1.098,3.521,2.293,5.222,3.528c0.659,0.505,1.686,1.29,2.128,1.65c1.437,1.169,2.843,2.376,4.244,3.588c8.982,7.769,17.282,16.32,26.61,23.688c10.342,8.168,22.071,15.885,35.871,15.395c11.99-0.425,21.64-6.611,29.013-15.197c16.804,1.829,33.611,3.619,50.43,5.305c10.596,1.062,19.5-9.674,19.5-19.5C3610.457,593.91,3601.529,586.901,3590.957,585.842z');
                shape.attr('fill', '#6e6e6e');
                shape.attr('class', 'hills5');

                shape = clipGroup[4].append('path');
                shape.attr('d', 'M4206.82,546.153c-2.918-10.609-13.625-15.943-23.987-13.62c-58.22,13.053-478.782,64.351-484.683,63.006c-10.354-2.358-21.076,3.037-23.987,13.62c-2.722,9.896,3.256,21.626,13.62,23.987c28.826,6.566,58.221,9.399,87.732,10.089c-0.023,0.369-0.038,0.739-0.038,1.11c0,11.065,8.89,18.925,19.5,19.5c32.309,1.752,64.686,1.423,96.944-1.11c31.577-2.479,63.762-6.276,94.342-14.775c28.164-7.828,55.008-19.871,81.623-31.789c6.121-2.741,12.24-5.487,18.376-8.196c3.071-1.356,6.15-2.695,9.233-4.024c0.274-0.118,1.815-0.772,2.628-1.119c1.704-0.712,3.411-1.42,5.12-2.119c13.094-5.361,26.405-10.181,39.982-14.17c1.65-0.485,3.31-0.943,4.969-1.4c3.625-1,6.728-3.026,9.119-5.664c11.861-3.45,23.804-6.628,35.886-9.337C4203.573,567.815,4209.535,556.021,4206.82,546.153z');
                shape.attr('fill', '#6e6e6e');
                shape.attr('class', 'hills5');

                clipGroup[4].attr('data-from', 'M4435,620c-22.445-0.416-46.928,0-73.896,0c-294.693,0-294.693,0-589.387,0c-294.695,0-294.695,0-589.389,0c-294.695,0-294.695,0-589.391,0s-294.695,0-589.394,0c-294.697,0-294.697,0-589.394,0s-294.697,0-589.394,0c-294.698,0-294.698,0-589.396,0C128.849,620,68,620,0,620v1200h4435v620z');
                clipGroup[4].attr('data-to', 'M4435,538.081c-22.445-0.416-46.928-0.622-73.896-0.622c-294.693,0-294.693,80-589.387,80c-294.695,0-294.695-80-589.389-80c-294.695,0-294.695,80-589.391,80s-294.695-80-589.394-80c-294.697,0-294.697,80-589.394,80s-294.697-80-589.394-80c-294.698,0-294.698,80-589.396,80c-106.511,0-176.163-17.506-235.36-37.28v1200h4435v538.081z');
                clipGroup[4].attr('clip-path', 'url(#clip4)');
                clips[4] = svg.append('clipPath').attr('id', 'clip4');
                paths[4] = clips[4].append('path').attr('d', clipGroup[4].attr('data-from'));

                /*
                    //mountains
                    el[1] = s.group();
                    el[1].add(
                        s.rect(1.797, 304.875, 4433, 463).attr({fill: "#d5d5d5", 'class': 'hills1'}),
                        s.circle(1458, 328, 48).attr({fill: "#fff"}),
                        s.circle(1265, 311, 48).attr({fill: "#fff"}),
                        s.circle(882, 291, 48).attr({fill: "#fff"}),
                        s.circle(363, 304, 48).attr({fill: "#fff"}),
                        s.circle(2140, 336, 48).attr({fill: "#fff"}),
                        s.circle(2986, 304, 48).attr({fill: "#fff"}),
                        s.circle(2226, 342, 48).attr({fill: "#fff"})
                    );
                    el[1].data("from", "M4402.739,450c-23.917,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.835,0s-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.836,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.836,0s-23.918,0-47.835,0s-23.917,0-47.835,0s-23.918,0-47.836,0s-23.918,0-47.835,0c-23.919,0-23.919,0-47.837,0s-23.918,0-47.835,0c-23.919,0-23.919-1.193-47.837-1.193S3374.281,450,3350.364,450c-23.919,0-23.919,0-47.837,0s-23.918,0-47.835,0c-23.918,0-23.918,0-47.836,0c-23.917,0-23.917,0-47.835,0s-23.918,0-47.836,0s-23.918,0-47.836,0s-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0s-23.918,0-47.837,0c-23.917,0-23.917,0-47.835,0s-23.918,0-47.837,0c-23.918,0-23.918,0-47.836,0c-23.917,0-23.917,0-47.833,0c-23.915,0-23.915,0-47.83,0c-23.917,0-23.917,0-47.834,0c-23.916,0-23.916,0-47.833,0c-23.915,0-23.915,0-47.831,0c-23.918,0-23.918,0-47.835,0s-23.917,0-47.833,0s-23.916,0-47.832,0c-23.919,0-23.919,0-47.838,0c-23.916,0-23.916,0-47.832,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.835,0c-23.916,0-23.916,0-47.833,0c-23.919,0-23.919,0-47.838,0c-23.917,0-23.917,0-47.833,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.917,0-23.917,0-47.834,0c-23.919,0-23.919,0-47.838,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.837,0c-23.918,0-23.917,0-47.835,0c-23.917,0-23.917,0-47.835,0c-23.919,0-23.919,0-47.838,0c-23.918,0-23.918,0-47.835,0c-23.918,0-23.918,0-47.836,0c-23.92,0-23.919,0-47.839,0c-23.918,0-23.918,0-47.837,0c-23.918,0-23.918,0-47.836,0s-23.918,0-47.836,0s-23.918,0-47.837,0c-23.919,0-23.919,0-47.839,0c-23.92,0-23.92,0-47.839,0s-23.919,0-47.839,0c-23.919,0-23.919,0-47.839,0c-23.919,0-23.919,0-47.838,0s-23.919,0-47.838,0s-23.919,0-47.837,0c-23.92,0-23.92,0-47.84,0c-23.919,0-23.919,0-47.838,0c-23.92,0-23.92,0-47.839,0s-23.919,0-47.838,0c-23.919,0-23.919,0-47.839,0c-23.92,0-23.92,0-47.84,0c-23.917,0-23.917,0-47.834,0c-23.918,0-23.918,0-47.836,0c-23.92,0-23.92,0-47.841,0c-23.918,0-23.918,0-47.837,0c-23.919,0-23.919,0-47.839,0c-23.918,0-23.918,0-47.837,0c-23.919,0-23.919,0-47.839,0s-23.919,0-47.839,0c-23.921,0-23.921,0-47.842,0s-23.921,0-47.842,0c-23.92,0-23.92,0-47.841,0c-23.921,0-23.921,0-47.843,0c-23.92,0-23.92,0-47.84,0c-0.616,0-1.212-0.076-1.797,0v318h4435V450C4423.999,450,4419.927,450,4402.739,450z");
                    el[1].data("to", "M4402.739,409.892c-23.917,0-23.917-16.267-47.835-16.267c-23.917,0-23.917,25.312-47.834,25.312c-23.918,0-23.918-54.833-47.835-54.833s-23.917,48.942-47.835,48.942c-23.917,0-23.917-91.232-47.834-91.232c-23.918,0-23.918,112.102-47.837,112.102c-23.917,0-23.917-98.037-47.835-98.037c-23.917,0-23.917,24.844-47.834,24.844c-23.918,0-23.918,34.378-47.837,34.378c-23.917,0-23.917-90.226-47.835-90.226c-23.917,0-23.917,44.382-47.834,44.382c-23.918,0-23.918,84.521-47.836,84.521c-23.917,0-23.917-33.216-47.834-33.216c-23.918,0-23.918-85.547-47.836-85.547s-23.918,96.386-47.835,96.386s-23.917-47.061-47.835-47.061s-23.918,65.458-47.836,65.458s-23.918-37.603-47.835-37.603c-23.919,0-23.919-18.963-47.837-18.963s-23.918,60.041-47.835,60.041c-23.919,0-23.919,15.533-47.837,15.533s-23.918-31.13-47.835-31.13c-23.919,0-23.919-103.016-47.837-103.016s-23.918,99.299-47.835,99.299c-23.918,0-23.918-16.29-47.836-16.29c-23.917,0-23.917-72.287-47.835-72.287s-23.918,104.572-47.836,104.572s-23.918,0.727-47.836,0.727s-23.918-112.816-47.837-112.816c-23.917,0-23.917,93.445-47.835,93.445s-23.918-63.646-47.837-63.646c-23.917,0-23.917,76.929-47.835,76.929s-23.918-47.853-47.837-47.853c-23.918,0-23.918,59.188-47.836,59.188c-23.917,0-23.917-34.322-47.833-34.322c-23.915,0-23.915,22.663-47.83,22.663c-23.917,0-23.917-2.019-47.834-2.019c-23.916,0-23.916-77.129-47.833-77.129c-23.915,0-23.915,57.779-47.831,57.779c-23.918,0-23.918,21.823-47.835,21.823s-23.917-65.511-47.833-65.511s-23.916,89.524-47.832,89.524c-23.919,0-23.919-31.635-47.838-31.635c-23.916,0-23.916,22.956-47.832,22.956c-23.917,0-23.917-86.899-47.834-86.899c-23.918,0-23.918,41.763-47.835,41.763c-23.916,0-23.916-74.859-47.833-74.859c-23.919,0-23.919,122.481-47.838,122.481c-23.917,0-23.917-43.182-47.833-43.182c-23.918,0-23.918-53.135-47.837-53.135c-23.917,0-23.917,87.116-47.834,87.116c-23.918,0-23.918-41.411-47.837-41.411c-23.917,0-23.917,25.549-47.834,25.549c-23.919,0-23.919-95.072-47.838-95.072c-23.917,0-23.917,107.309-47.834,107.309c-23.918,0-23.918-89.945-47.837-89.945c-23.918,0-23.917,105.822-47.835,105.822c-23.917,0-23.917-30.711-47.835-30.711c-23.919,0-23.919-80.547-47.838-80.547c-23.918,0-23.918,62.859-47.835,62.859c-23.918,0-23.918-91.01-47.836-91.01c-23.92,0-23.919,106.433-47.839,106.433c-23.918,0-23.918-28.378-47.837-28.378c-23.918,0-23.918,40.077-47.836,40.077s-23.918-103.779-47.836-103.779s-23.918,105.795-47.837,105.795c-23.919,0-23.919-18.489-47.839-18.489c-23.92,0-23.92,9.5-47.839,9.5s-23.919-57.052-47.839-57.052c-23.919,0-23.919,44.183-47.839,44.183c-23.919,0-23.919-72.319-47.838-72.319s-23.919,92.194-47.838,92.194s-23.919-111.578-47.837-111.578c-23.92,0-23.92,108.041-47.84,108.041c-23.919,0-23.919-42.549-47.838-42.549c-23.92,0-23.92,2.34-47.839,2.34s-23.919-68.62-47.838-68.62c-23.919,0-23.919,93.136-47.839,93.136c-23.92,0-23.92-51.614-47.84-51.614c-23.917,0-23.917,69.081-47.834,69.081c-23.918,0-23.918,6.511-47.836,6.511c-23.92,0-23.92-61.143-47.841-61.143c-23.918,0-23.918,44.471-47.837,44.471c-23.919,0-23.919-94.331-47.839-94.331c-23.918,0-23.918,91.588-47.837,91.588c-23.919,0-23.919,6.229-47.839,6.229s-23.919-82.778-47.839-82.778c-23.921,0-23.921,63.681-47.842,63.681s-23.921,1.675-47.842,1.675c-23.92,0-23.92-71.316-47.841-71.316c-23.921,0-23.921,71.247-47.843,71.247c-23.92,0-23.92-30.831-47.84-30.831c-0.616,0-1.212,0.048-1.797,0.124V768h4435V321.666C4424.764,353.439,4419.927,409.892,4402.739,409.892z");
                    el[1].attr({
                        clip: el[1].data("from"),
                        'class': 'hills1'
                    });
                */

                parallaxGroupA = $('#parallaxA').find('.parallax-item');
                parallaxGroupB = $('#parallaxB').find('.parallax-item');
            
            }

            function animateSVGFlat() {
                for (var i = 0; i < clipGroup.length; i += 1) {
                    paths[i].transition().duration(2000).attr('d', clipGroup[i].attr('data-from'));
                }

                for (var i = 0; i < trees.length; i += 1) {
                    trees[i].transition().duration(2000).attr('transform', trees[i].attr('data-from'));
                }
            }

            function animateSVGCurve() {
                for (var i = 0; i < clipGroup.length; i += 1) {
                    paths[i].transition().duration(2000).attr('d', clipGroup[i].attr('data-to'));
                }

                for (var i = 0; i < trees.length; i += 1) {
                    trees[i].transition().duration(2000).attr('transform', trees[i].attr('data-to'));
                }
            }

            function setupCanvas() {
                canvas = $('#groundA1')[0];
                ctx = canvas.getContext('2d');

                AssetModel.loadGroup(1, function () {
                    setupImageList();
                    draw();    
                });
            }
          
//public
            instance.init = function () {
                var i = 0,
                    element;

                $body = $('body');
                $container = $('#layer1');
                $clouds = $('#cloudsA');

                //Determine if Canvas or SVG
                if (USE_CANVAS !== true) {
                    setupSVG();
                } else {
                    setupCanvas();
                }
            };

            instance.animateParallax = function (goal, duration) {
                if (USE_CANVAS !== true) {
                    var end = {x: goal};

                    new TWEEN.Tween(delta)
                        .to(end, duration)
                        .onUpdate(parallax)
                        .start();
                }
            };

            instance.update = function () {
                bgposition -= 1;
                $clouds.css({backgroundPosition: bgposition + 'px 150px'});
            };

    //state methods

            instance.setState = function (newState) {

                switch (newState) 
                {
                case "css":
                    $body.removeClass('night');
                    $body.removeClass('space');
                    $body.addClass('css');
                    instance.removeCurves();
                    instance.unrotate();
                    break;
                case "svg":
                    $body.removeClass('night');
                    $body.removeClass('space');
                    $body.addClass('css');
                    instance.addCurves();
                    instance.unrotate();
                    break;
                case "3d":
                    $body.removeClass('night');
                    $body.addClass('css');
                    $body.addClass('space');
                    instance.addCurves();
                    instance.unrotate();
                    break;
                case "blend":
                    $body.removeClass('space');
                    $body.addClass('night');
                    instance.rotate();
                    break;
                default:
                    instance.removeAll();
                    instance.unrotate();
                    break;
                }
            }

            instance.removeCurves = function () {
                if (USE_CANVAS === true) {
                    goalFrame = 4;
                    updateTerrain();
                } else {
                    if (curvy === true) {
                        animateSVGFlat();
                    }
                }

                curvy = false;
            };

            instance.addCurves = function () {
                
                _log('add curve', curvy);
                if (USE_CANVAS === true) {
                    goalFrame = 9;
                    updateTerrain();
                } else {
                    if (curvy === false) {
                        animateSVGCurve();
                    }
                }

                curvy = true;
            };

            instance.rotate = function () {
                CSS3Helper.setTransform($('#planet1')[0], 'translateZ(-1000px) rotateY(180deg)');
                rotated = true;
            };

            instance.unrotate = function () {
                CSS3Helper.setTransform($('#planet1')[0], 'translateZ(-1000px)');
                rotated = false;
            };

            instance.removeAll = function () {
                $body.removeClass('space');
                $body.removeClass('css');
                instance.removeCurves();
            };

		};

		return new Scenery();
    });
